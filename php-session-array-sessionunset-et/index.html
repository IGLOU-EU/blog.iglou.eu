<!doctype html><html lang=fr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes,viewport-fit=cover"><title>[PHP] $_SESSION = array(), session_unset et session_destroy() | Blog Iglou.eu</title><meta property="og:title" content="[PHP] $_SESSION = array(), session_unset et session_destroy() | Blog Iglou.eu"><meta property="og:locale" content="fr_fr"><meta name=theme-color content="#dbf3f4"><meta name=author content="Adrien K"><meta name=description content="Session my PHP Aidant de temps en temps sur des forums ou en IRC, je tombe par moment sur des personnes qui mélangent, confondes et font des mélimélo perso. Mais pas seulement, il arrive que ce soit les &amp;ldquo;helpers&amp;rdquo; qui induisent en erreur (et là, c&amp;rsquo;est le drame) &amp;hellip;

 
Dans ce post nous allons parler des sessions avec PHP, et plus particulièrement de leurs destruction.
Croisé sur le net  session_unset() ne doit pas étre utilisé car il détruira également la super globale $_SESSION qui deviendra inutilisable."><meta property="og:type" content="article"><meta property="og:description" content="Session my PHP Aidant de temps en temps sur des forums ou en IRC, je tombe par moment sur des personnes qui mélangent, confondes et font des mélimélo perso. Mais pas seulement, il arrive que ce soit les &amp;ldquo;helpers&amp;rdquo; qui induisent en erreur (et là, c&amp;rsquo;est le drame) &amp;hellip;

 
Dans ce post nous allons parler des sessions avec PHP, et plus particulièrement de leurs destruction.
Croisé sur le net  session_unset() ne doit pas étre utilisé car il détruira également la super globale $_SESSION qui deviendra inutilisable."><meta property="og:publish_date" name=publish_date content="2015-03-24T18:30:00Z"><meta property="article:published_time" content="2015-03-24T18:30:00Z"><meta property="article:modified_time" content="2022-04-03T13:54:16+02:00"><meta property="article:author" content="Adrien K"><meta property="article:tag" content="programmation"><meta property="og:site_name" content="Blog Iglou.eu"><meta property="og:type" content="blog"><link rel=icon href="data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ctext y=%22.9em%22 font-size=%2290%22%3E%F0%9F%92%BE%3C/text%3E%3C/svg%3E"><link rel=canonical href=https://blog.iglou.eu/php-session-array-sessionunset-et/><meta property="og:url" content="https://blog.iglou.eu/php-session-array-sessionunset-et/"><style>:root{--c-dark:#33331a;--c-light:#dbf3f4;--c-primary:var(--c-light);--c-secondary:var(--c-dark);--ff-monospace:'Roboto Mono', SFMono-Regular, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;--ff-sans-serif:'Roboto', "Segoe UI", "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif}pre,code{--c-secondary:var(--c-light);--c-primary:var(--c-dark)}.btn:hover,.btn:focus{--c-primary:var(--c-dark);--c-secondary:var(--c-light)}*,::after,::before{box-sizing:border-box}.link.inherit{color:inherit}.link.important{color:var(--c-primary);border:.1em dotted transparent;padding:.25em .5em;text-decoration:underline double .05em}.link.important:hover,.link.important:focus{border-color:var(--c-primary);text-decoration:underline .1em}.link.svg{line-height:0;text-decoration:none}.link.svg>svg{fill:var(--c-primary);height:2em}.btn{color:var(--c-primary);border:.1em solid;padding:.25em .5em;display:inline-block;text-decoration:none;background-color:var(--c-secondary)}.intext{font-size:inherit;display:inline}.monospace{font-family:var(--ff-monospace)}.capitalize{text-transform:capitalize}.right{text-align:right}.center{text-align:center}.m0{margin:0}.emoji{color:transparent;text-shadow:0 0 0 var(--c-primary)}.hr{margin:1em 0;border:none;border-bottom:.1em solid var(--c-primary)}.infos,.ariane{padding:.25em .5em;font-weight:700}.infos{gap:.5em;display:grid;margin-top:.5em;margin-bottom:.5em;grid-template-columns:1fr auto}.ariane{border:.1em solid var(--c-primary);border-left:none;border-right:none}body{color:var(--c-primary);font-size:1.2rem;line-height:1.4rem;font-family:var(--ff-sans-serif);background-color:var(--c-secondary);max-width:70em;margin:auto}.article h2::after{content:"";display:block;width:60%;height:1px;background-color:var(--c-primary);margin-top:.15em}pre{color:var(--c-primary);padding:1em;overflow:auto;max-height:100vh;background:var(--c-secondary)}code:not([data-lang]){color:var(--c-primary);background:var(--c-secondary);font-family:var(--ff-monospace);border-radius:3px}.site_title{font-size:3em;text-align:center;line-height:initial;text-shadow:0 0 1px var(--c-primary),0 0 1px var(--c-primary)}.article{margin:1em auto;max-width:80rem}.article_content__img{width:30em;color:var(--c-secondary);cursor:pointer;padding:1em;max-width:100%;text-align:center;font-style:italic;font-weight:700;background-color:var(--c-primary)}.article_content__img_src,.article_content__img:focus{width:100%}.article_content__img_src{max-height:50vh;object-fit:contain}.article_content__img:focus .article_content__img_src{max-height:100vh}.article_comm{margin-top:2em}.main.branch{display:grid;line-height:1.5em;grid-template-columns:minmax(25em,2fr)minmax(10em,1fr)}.articles{width:fit-content;margin:auto}.article_link{border:.1em solid var(--c-primary);margin:1em 0;padding:1.5em;max-width:50em;font-weight:700}.article_link__header,.article_link__footer{gap:1em;display:grid}.article_link__header{margin-bottom:1.5em;grid-template-columns:minmax(15rem,1fr)1fr}.article_link__footer{margin-top:2em;grid-template-columns:1fr auto}.article_link__title>.link{line-height:1.25em;text-decoration:underline .1em transparent}.article_link__title>.link:hover,.article_link__title>.link:focus{text-decoration-color:var(--c-primary)}.paginator{font-size:1.25em;text-align:center}.author{color:var(--c-primary);width:fit-content;margin:1em auto;height:fit-content;padding:0 1em 1em;max-width:20em;background-color:var(--c-secondary)}.author_view{border-radius:1em;width:100%}.author_desc__name{margin-bottom:.25em}.author_social{display:flex;justify-content:space-between}@media(max-width:768px){body{font-size:1rem}.site_title{font-size:1.8em}.main.branch{display:block}.author{max-width:initial}.author_view{max-width:20em}.infos{display:block}.infos>span{padding:0 .15em;border-style:solid;border-width:0 0 0 1px}.article_content__img{margin:auto}.article{margin:1em .15em}.article_comm .btn{margin:.25em}}</style></head><body><header><h1 class="site_title monospace"><a href=/ class="link inherit">Blog.Iglou.eu</a></h1><div class="ariane monospace">/&#8239;<a href=/ class="link inherit">Home</a>&#8239;/&#8239;<h2 class="intext capitalize">[PHP] $_SESSION = array(), session_unset et session_destroy()</h2></div><aside class="infos monospace"><span class=infos_by>Par Adrien K</span>
<span class="infos_date right">Le <time class="article_link__date_format text_neon blue" datetime=2015-03-24T18:30:00Z>24 Mar 2015</time>
· Maj le <time class="article_link__date_format text_neon blue" datetime=2022-04-03T13:54:16+02:00>03 Apr 2022</time></span>
<span class=infos_time>Lecture 2 minutes</span>
<span class="infos_tags capitalize right"><a class="article_link__tag link important programmation" href=/tags/programmation/>programmation</a></span></aside></header><main class=main><article class=article><h3 id=session-my-php>Session my PHP</h3><p>Aidant de temps en temps sur des forums ou en IRC, je tombe par moment sur des personnes qui mélangent, confondes et font des mélimélo perso. Mais pas seulement, il arrive que ce soit les &ldquo;helpers&rdquo; qui induisent en erreur (et là, c&rsquo;est le drame) &mldr;</p><p></p><figure class=article_content__img tabindex=0><img src=/images/php.jpg alt="Image de presentation" referrerpolicy=no-referrer loading=lazy class=article_content__img_src></figure><p></p><p>Dans ce post nous allons parler des sessions avec PHP, et plus particulièrement de leurs destruction.</p><h4 id=croisé-sur-le-net>Croisé sur le net</h4><ol><li>session_unset() ne doit pas étre utilisé car il détruira également la super globale $_SESSION qui deviendra inutilisable.</li><li>On doit utiliser $_SESSION = array() puis session_unset() avant de &ldquo;destroy&rdquo;</li><li>Il est inutile de vider $_SESSION si on fait un session_destroy()</li><li>$_SESSION = array() et session_unset() font exactement la même chose</li></ol><h4 id=alors-que>Alors que</h4><ol><li>Bien sur c&rsquo;est faux. session_unset va entre autre vider $_SESSION, en revanche si l&rsquo;on indique session_unset($_SESSION) on rigole jaune. C&rsquo;est au passage indiqué sur le man de PHP &mldr;</li><li>Encore une idée étrange. Les deux vont faire une chose, c&rsquo;est vider $_SESSION. Alors hors idée perverse d&rsquo;utiliser le double de ressources c&rsquo;est pas utile.</li><li>session_destroy() vas détruire le fichier de session, mais ne vide pas la mémoire. On peut donc toujours accéder aux données.</li><li>C&rsquo;est pas si faux que ça et en vulgarisation c&rsquo;est le cas. La seul différence est que session_unset(), va vérifier si ce qui est passé en arguments correspond bien à une &ldquo;php_session_active&rdquo;.</li></ol><h4 id=exemples-et-sources>Exemples et sources</h4><p>Je vois déjà des &ldquo;c&rsquo;est bien beau, mais comment on peut savoir si toi aussi tu racontes pas des conneries ?&rdquo;<br>Pour le 1er et 2eme points il est simple de vérifier : <a href=http://php.net/manual/fr/function.session-unset.php class="article_content__link link inherit" rel="noreferrer nofollow noopener">http://php.net/manual/fr/function.session-unset.php</a></p><p>Pour le 2eme point on peut tout de même vérifier :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>session_start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$_SESSION[<span style=color:#e6db74>&#39;time&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>time</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>session_unset</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>var_dump</span>($_SESSION);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$_SESSION <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>var_dump</span>($_SESSION);
</span></span></code></pre></div><p>Le 3eme points est très simple à tester :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>session_start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$_SESSION[<span style=color:#e6db74>&#39;time&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>time</span>();
</span></span><span style=display:flex><span>$a <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>$_SESSION;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>session_destroy</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>var_dump</span>($a);
</span></span></code></pre></div><p>Le 4eme points ce trouve dans la <a href=https://github.com/php/php-src/blob/663074b6b1fa4534fbbb65462aeef40f2c983ad5/ext/session/session.c#L2267 class="article_content__link link inherit" rel="noreferrer nofollow noopener">source de php</a> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#a6e22e>PHP_FUNCTION</span>(session_unset)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (PS(session_status) <span style=color:#f92672>!=</span> php_session_active)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        RETURN_FALSE;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    IF_SESSION_VARS() 
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        HashTable <span style=color:#f92672>*</span>ht_sess_var <span style=color:#f92672>=</span> Z_ARRVAL_P(Z_REFVAL(PS(http_session_vars)));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>/* Clean $_SESSION. */</span>
</span></span><span style=display:flex><span>        zend_hash_clean(ht_sess_var);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><em>Pour faire le ménage du client <code>_setcookie(session_name(),'',0,'/');</code> ce qui supprime le cookie utilisateur de sa session.</em></p><p><strong>éa, les amis.</strong></p><aside class="article_comm right"><a class="article_comm__email btn inherit right monospace" href="mailto:adrien@iglou.eu?subject=%5BCommentaire%5D+%5bPHP%5d%20%24_SESSION%20%3d%20array%28%29%2c%20session_unset%20et%20session_destroy%28%29&body=Bonjour%20Adrien%2C%0D%0A">M'envoyer un commentaire</a>
·
<a class="article_comm__issue btn inherit right monospace" href="https://github.com/IGLOU-EU/blog.iglou.eu/issues/new?title=Erreur:+%5bPHP%5d%20%24_SESSION%20%3d%20array%28%29%2c%20session_unset%20et%20session_destroy%28%29&body=Lien:+https%3a%2f%2fblog.iglou.eu%2fphp-session-array-sessionunset-et%2f%0A%0AMince+quel+est+mon+erreur+?%0A">Reporter une erreur</a></aside></article></main><footer><hr class=hr><p class="footer monospace center">Site et contenue sous CC0 - Iconographie par Font Awesome - Sans Cookies ni tracking</p></footer></body></html>