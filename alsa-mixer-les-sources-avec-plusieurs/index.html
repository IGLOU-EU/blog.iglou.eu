<!doctype html><html lang=fr-fr dir=ltr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes,viewport-fit=cover"><title>[Alsa+Dmix] Mixer les sources pour plusieurs cartes | Blog Iglou.eu</title>
<link rel=icon href=%7b%7d><link rel=canonical href=https://blog.iglou.eu/alsa-mixer-les-sources-avec-plusieurs/><meta itemprop=name content="[Alsa+Dmix] Mixer les sources pour plusieurs cartes"><meta itemprop=description content="Cet article est issu d’une importation historique.
Il fut fait sans correcteur orthographique et grammaticale, il est aussi fort probable que des images et liens soient indisponible. Voici déjà plus de 4jours que je cherchais la solution afin d’avoir le mixage des sources avec plusieurs cartes son. Par la suite de mes recherches, j’avais déjà posté sur comment utiliser plusieurs cartes son avec Alsa."><meta itemprop=datePublished content="2014-03-16T22:44:00+00:00"><meta itemprop=dateModified content="2014-03-17T18:17:55+00:00"><meta itemprop=wordCount content="622"><meta itemprop=keywords content="Linux"><meta property="og:url" content="https://blog.iglou.eu/alsa-mixer-les-sources-avec-plusieurs/"><meta property="og:site_name" content="Blog Iglou.eu"><meta property="og:title" content="[Alsa+Dmix] Mixer les sources pour plusieurs cartes"><meta property="og:description" content="Cet article est issu d’une importation historique.
Il fut fait sans correcteur orthographique et grammaticale, il est aussi fort probable que des images et liens soient indisponible. Voici déjà plus de 4jours que je cherchais la solution afin d’avoir le mixage des sources avec plusieurs cartes son. Par la suite de mes recherches, j’avais déjà posté sur comment utiliser plusieurs cartes son avec Alsa."><meta property="og:locale" content="fr_fr"><meta property="og:type" content="article"><meta property="article:published_time" content="2014-03-16T22:44:00+00:00"><meta property="article:modified_time" content="2014-03-17T18:17:55+00:00"><meta property="article:tag" content="Linux"><link href=https://blog.iglou.eu/index.xml rel=alternate type=application/rss+xml title="Blog Iglou.eu"><link rel=stylesheet href=/css/style.min.04f4b7997c4f8621b627767bda0b5f35702bcb14fff156b6c784df451dba02e0.css integrity="sha256-BPS3mXxPhiG2J3Z72gtfNXAryxT/8Va2x4TfRR26AuA=" crossorigin=anonymous></head><body><div class=toggle-widget id=open-left_panel><style>#open-left_panel .toggle-close{display:none}#open-left_panel:target~.content-main .left_panel{display:block;position:fixed;top:0;left:0;right:0;bottom:0;overflow:auto;z-index:10}#open-left_panel:target .toggle-icon-line{background-color:var(--color-wtoggle-line-focus)}#open-left_panel:target .toggle-icon-line.vertical{transform:rotate(360deg)}#open-left_panel:target .toggle-icon-line.horizontal{transform:rotate(180deg)}#open-left_panel:target .toggle-close{display:initial}#open-left_panel:target .toggle-open{display:none}</style><div class=toggle-icon><span class="toggle-icon-line vertical"></span>
<span class="toggle-icon-line horizontal"></span></div><a class="toggle-open toggle-link" title="Ouvrir Left panel" href=#open-left_panel></a><a class="toggle-close toggle-link" title="Fermer Left panel" href=#close-left_panel></a></div><header class=site-header><h1>Blog Iglou.eu</h1><nav class=main-menu><ul><li><a href=/>Accueil</a></li></ul></nav></header><main class=content-main><div class=top_panel><aside class=article-info><span class=date-info>Le <time class=published datetime=2014-03-16T22:44:00Z>16 Mar 2014
</time>· Maj le <time class=editited datetime=2014-03-17T18:17:55Z>17 Mar 2014
</time></span><span class=spacer></span>
<span class=reading-time>2-4 minutes</span></aside></div><div class=left_panel><aside class=sidebar><div class=toc><h2 class=toc-title>Table des Matières</h2><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></div><div class=tags><h2 class=tags-title>Tags</h2><ul class=tags-list><li class=tags-item><a class=tags-link href=https://blog.iglou.eu/tags/linux/>Linux</a></li></ul></div></aside></div><div class=right_panel><article class="blog-article markdown"><div class="box warning monospace"><span>Cet article est issu d&rsquo;une importation historique.<br>Il fut fait sans correcteur orthographique et grammaticale, il est aussi fort probable que des images et liens soient indisponible.</span></div><p>Voici déjà plus de 4jours que je cherchais la solution afin d&rsquo;avoir le mixage des sources avec plusieurs cartes son. Par la suite de mes recherches, j&rsquo;avais déjà posté sur comment utiliser plusieurs cartes son avec Alsa.</p><p></p><figure class=article-img><a href=/images/www.noulakaz.net-weblog-images-20050814-dmix.jpg target=_blank title="Ouvrir l'image dans un onglet"><img src=/images/www.noulakaz.net-weblog-images-20050814-dmix.jpg alt="Image de presentation" referrerpolicy=no-referrer loading=lazy class=img-src></a></figure><p></p><p>N’ayant VRAIMENT pas envie d&rsquo;utiliser quelque chose comme Jack, PulseAudio et autres machines a gaz nécessitant moults configurations, direction Dmix le plugin d&rsquo;Alsa. Alsa, mixage de sources = Dmix.</p><p>Dmix est un serveur de son, il vient s&rsquo;interposer entre le logiciel source du signal audio et le pilote (Alsa). Il a pour vocation de mélanger les sources audio afin d&rsquo;en envoyer une unique au pilote. Dmix est un plugins activé par défaut sur les installations actuel de Alsa, il est contenu dans le package &ldquo;alsa-utils&rdquo;.</p><p>Le problème étant que Dmix n&rsquo;est pas capable de mixer des sources destiné a plusieurs cartes son. Il faut donc indiquer a Alsa que chaque carte son est traité par Dmix indépendamment et ensuite envoyé au pilote qui les regroupes.</p><p>Les problèmes :</p><p>1- Pas de cartes son multiples avec Dmix</p><p>2- Dmix cause une perte de qualité sonore</p><p>3- Le traitement des cartes son séparément demande d&rsquo;effectuer deux fois le boulot</p><h4 id=1-pas-de-cartes-son-multiples>1) Pas de cartes son multiples</h4><p>Comme nous l&rsquo;avons vu Dmix est activé pas défaut, mais n&rsquo;est pas capable de mixer plusieurs cartes. Celui-ci est désactivé si plusieurs cartes sont configuré pour alsa.</p><p>Voici la solution, définir dmix pour chaque carte indépendamment, puis lier la sortie. Script :</p><pre tabindex=0><code># réglage des cartes son, selon la commande « aplay -l », card = carte et device = périphérique
pcm.carteInterne {
    type hw
    card 0
    device 0
}

ctl.carteInterne {
    type hw
    card 0
    device 0
}

pcm.carteUsb {
    type hw
    card 2
    device 0
}

ctl.carteUsb {
    type hw
    card 2
    device 0
}

# Creation d&#39;un Dmix pour chacune 
pcm.interneMix {
    type dmix
    ipc_key 1024
    ipc_key_add_uid false
    ipc_perm 0666
    slave {
        pcm &#34;carteInterne&#34;
        channels 2
        periods 128
        period_time 0
        period_size 2048
        buffer_size 4096
    }
    bindings {
        0 0
        1 1
    }
}

pcm.usbMix {
    type dmix
    ipc_key 2048
    ipc_key_add_uid false
    ipc_perm 0666
    slave {
        pcm &#34;carteUsb&#34;
        channels 2
        periods 128
        period_time 0
        period_size 2048
        buffer_size 4096
    }
    bindings {
        0 0
        1 1
    }
}

# Sortie multi cartes
pcm.both {
    type route;
    slave.pcm {
        type multi;
        slaves.a.pcm &#34;interneMix&#34;;
        slaves.b.pcm &#34;usbMix&#34;;
        slaves.a.channels 2;
        slaves.b.channels 2;

        bindings.0.slave a;
        bindings.0.channel 0;
        bindings.1.slave a;
        bindings.1.channel 1;
     
        bindings.2.slave b;
        bindings.2.channel 0;
        bindings.3.slave b;
        bindings.3.channel 1;
    }
    ttable.0.0 1;
    ttable.1.1 1;
  
    ttable.0.2 1;
    ttable.1.3 1;
}

pcm.!default {
        type plug
        slave {
                pcm both
        }
}

ctl.!default {
        type hw
        card 2
}
</code></pre><h4 id=2-perte-de-qualité-sonore>2) Perte de qualité sonore</h4><p>La seul solution a ma connaissance est d’éviter le ré-échantillonnage. A la base Alsa à une fréquence d&rsquo;échantillonnage de 48000hz, n’écoutant que des flac provenant de rip cd a une fréquence de 44100hz ce n&rsquo;est pas adapté.</p><p>Il faut donc passer en &ldquo;rate 44100&rdquo; (regardez le rate de vos medias).</p><p>Deux façons de faire, ajouter la ligne &ldquo;defaults.pcm.dmix.!rate 44100&rdquo; a votre fichier .asoundrc, soit ajouter &ldquo;rate 44100&rdquo; dans la section slave de votre carte avec dmix.</p><p>Même chose pour :</p><p>defaults.pcm.dmix.!rate_converter &ldquo;samplerate_best&rdquo;, qui interviens si malgré tout il y avait besoin d&rsquo;un re-échantillonnage</p><h4 id=3-effectuer-deux-fois-le-boulot>3) Effectuer deux fois le boulot</h4><p>Il est possibles que les veilles config ne supporte pas la solution <strong>1</strong>, il est donc possible de réaliser deux fichier asoundrc que l&rsquo;on &ldquo;switch&rdquo; suivant l&rsquo;utilisation de l&rsquo;une ou l&rsquo;autre carte son.</p><hr><p>En esperant n&rsquo;avoir rien oublié, plus d&rsquo;informations disponibles sur
<a href=http://fr.wikipedia.org/wiki/Advanced_Linux_sound_architecture class=external-link rel="noreferrer nofollow noopener" target=_blank>wikipedia</a>
,
<a href=http://doc.ubuntu-fr.org/son class=external-link rel="noreferrer nofollow noopener" target=_blank>wikiUbuntu</a>
,
<a href=http://alsa.opensrc.org/Dmix class=external-link rel="noreferrer nofollow noopener" target=_blank>DmixAlsa</a>
et le script est aussi disponible sur le
<a href=http://wiki.archlinux.fr/Alsa class=external-link rel="noreferrer nofollow noopener" target=_blank>wikiArchLinux</a></p><p><strong>éa, les amis.</strong></p></article></div></main><footer class=site-footer><p>Copyright 2024 CC0 - Sans Cookies ni tracking</p></footer></body></html>