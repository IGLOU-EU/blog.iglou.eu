<!doctype html><html lang=fr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes,viewport-fit=cover"><title>[Alsa+Dmix] Mixer les sources pour plusieurs cartes | Blog Iglou.eu</title><meta property="og:title" content="[Alsa+Dmix] Mixer les sources pour plusieurs cartes | Blog Iglou.eu"><meta property="og:locale" content="fr_fr"><meta name=theme-color content="#dbf3f4"><meta name=author content="Adrien K"><meta name=description content="Voici déjà plus de 4jours que je cherchais la solution afin d&amp;rsquo;avoir le mixage des sources avec plusieurs cartes son. Par la suite de mes recherches, j&amp;rsquo;avais déjà posté sur comment utiliser plusieurs cartes son avec Alsa.

 
N’ayant VRAIMENT pas envie d&amp;rsquo;utiliser quelque chose comme Jack, PulseAudio et autres machines a gaz nécessitant moults configurations, direction Dmix le plugin d&amp;rsquo;Alsa. Alsa, mixage de sources = Dmix.
Dmix est un serveur de son, il vient s&amp;rsquo;interposer entre le logiciel source du signal audio et le pilote (Alsa)."><meta property="og:type" content="article"><meta property="og:description" content="Voici déjà plus de 4jours que je cherchais la solution afin d&amp;rsquo;avoir le mixage des sources avec plusieurs cartes son. Par la suite de mes recherches, j&amp;rsquo;avais déjà posté sur comment utiliser plusieurs cartes son avec Alsa.

 
N’ayant VRAIMENT pas envie d&amp;rsquo;utiliser quelque chose comme Jack, PulseAudio et autres machines a gaz nécessitant moults configurations, direction Dmix le plugin d&amp;rsquo;Alsa. Alsa, mixage de sources = Dmix.
Dmix est un serveur de son, il vient s&amp;rsquo;interposer entre le logiciel source du signal audio et le pilote (Alsa)."><meta property="og:publish_date" name=publish_date content="2014-03-16T22:44:00Z"><meta property="article:published_time" content="2014-03-16T22:44:00Z"><meta property="article:modified_time" content="2022-04-03T13:54:16+02:00"><meta property="article:author" content="Adrien K"><meta property="article:tag" content="linux"><meta property="og:site_name" content="Blog Iglou.eu"><meta property="og:type" content="blog"><link rel=icon href="data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ctext y=%22.9em%22 font-size=%2290%22%3E%F0%9F%92%BE%3C/text%3E%3C/svg%3E"><link rel=canonical href=https://blog.iglou.eu/alsa-mixer-les-sources-avec-plusieurs/><meta property="og:url" content="https://blog.iglou.eu/alsa-mixer-les-sources-avec-plusieurs/"><style>:root{--c-dark:#33331a;--c-light:#dbf3f4;--c-primary:var(--c-light);--c-secondary:var(--c-dark);--ff-monospace:'Roboto Mono', SFMono-Regular, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;--ff-sans-serif:'Roboto', "Segoe UI", "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif}pre,code{--c-secondary:var(--c-light);--c-primary:var(--c-dark)}.btn:hover,.btn:focus{--c-primary:var(--c-dark);--c-secondary:var(--c-light)}*,::after,::before{box-sizing:border-box}.link.inherit{color:inherit}.link.important{color:var(--c-primary);border:.1em dotted transparent;padding:.25em .5em;text-decoration:underline double .05em}.link.important:hover,.link.important:focus{border-color:var(--c-primary);text-decoration:underline .1em}.link.svg{line-height:0;text-decoration:none}.link.svg>svg{fill:var(--c-primary);height:2em}.btn{color:var(--c-primary);border:.1em solid;padding:.25em .5em;display:inline-block;text-decoration:none;background-color:var(--c-secondary)}.intext{font-size:inherit;display:inline}.monospace{font-family:var(--ff-monospace)}.capitalize{text-transform:capitalize}.right{text-align:right}.center{text-align:center}.m0{margin:0}.emoji{color:transparent;text-shadow:0 0 0 var(--c-primary)}.hr{margin:1em 0;border:none;border-bottom:.1em solid var(--c-primary)}.infos,.ariane{padding:.25em .5em;font-weight:700}.infos{gap:.5em;display:grid;margin-top:.5em;margin-bottom:.5em;grid-template-columns:1fr auto}.ariane{border:.1em solid var(--c-primary);border-left:none;border-right:none}body{color:var(--c-primary);font-size:1.2rem;line-height:1.4rem;font-family:var(--ff-sans-serif);background-color:var(--c-secondary);max-width:70em;margin:auto}.article h2::after{content:"";display:block;width:60%;height:1px;background-color:var(--c-primary);margin-top:.15em}pre{color:var(--c-primary);padding:1em;overflow:auto;max-height:100vh;background:var(--c-secondary)}code:not([data-lang]){color:var(--c-primary);background:var(--c-secondary);font-family:var(--ff-monospace);border-radius:3px}.site_title{font-size:3em;text-align:center;line-height:initial;text-shadow:0 0 1px var(--c-primary),0 0 1px var(--c-primary)}.article{margin:1em auto;max-width:80rem}.article_content__img{width:30em;color:var(--c-secondary);cursor:pointer;padding:1em;max-width:100%;text-align:center;font-style:italic;font-weight:700;background-color:var(--c-primary)}.article_content__img_src,.article_content__img:focus{width:100%}.article_content__img_src{max-height:50vh;object-fit:contain}.article_content__img:focus .article_content__img_src{max-height:100vh}.article_comm{margin-top:2em}.main.branch{display:grid;line-height:1.5em;grid-template-columns:minmax(25em,2fr)minmax(10em,1fr)}.articles{width:fit-content;margin:auto}.article_link{border:.1em solid var(--c-primary);margin:1em 0;padding:1.5em;max-width:50em;font-weight:700}.article_link__header,.article_link__footer{gap:1em;display:grid}.article_link__header{margin-bottom:1.5em;grid-template-columns:minmax(15rem,1fr)1fr}.article_link__footer{margin-top:2em;grid-template-columns:1fr auto}.article_link__title>.link{line-height:1.25em;text-decoration:underline .1em transparent}.article_link__title>.link:hover,.article_link__title>.link:focus{text-decoration-color:var(--c-primary)}.paginator{font-size:1.25em;text-align:center}.author{color:var(--c-primary);width:fit-content;margin:1em auto;height:fit-content;padding:0 1em 1em;max-width:20em;background-color:var(--c-secondary)}.author_view{border-radius:1em;width:100%}.author_desc__name{margin-bottom:.25em}.author_social{display:flex;justify-content:space-between}@media(max-width:768px){body{font-size:1rem}.site_title{font-size:1.8em}.main.branch{display:block}.author{max-width:initial}.author_view{max-width:20em}.infos{display:block}.infos>span{padding:0 .15em;border-style:solid;border-width:0 0 0 1px}.article_content__img{margin:auto}.article{margin:1em .15em}.article_comm .btn{margin:.25em}}</style></head><body><header><h1 class="site_title monospace"><a href=/ class="link inherit">Blog.Iglou.eu</a></h1><div class="ariane monospace">/&#8239;<a href=/ class="link inherit">Home</a>&#8239;/&#8239;<h2 class="intext capitalize">[Alsa+Dmix] Mixer les sources pour plusieurs cartes</h2></div><aside class="infos monospace"><span class=infos_by>Par Adrien K</span>
<span class="infos_date right">Le <time class="article_link__date_format text_neon blue" datetime=2014-03-16T22:44:00Z>16 Mar 2014</time>
· Maj le <time class="article_link__date_format text_neon blue" datetime=2022-04-03T13:54:16+02:00>03 Apr 2022</time></span>
<span class=infos_time>Lecture 4 minutes</span>
<span class="infos_tags capitalize right"><a class="article_link__tag link important linux" href=/tags/linux/>linux</a></span></aside></header><main class=main><article class=article><p>Voici déjà plus de 4jours que je cherchais la solution afin d&rsquo;avoir le mixage des sources avec plusieurs cartes son. Par la suite de mes recherches, j&rsquo;avais déjà posté sur comment utiliser plusieurs cartes son avec Alsa.</p><p></p><figure class=article_content__img tabindex=0><img src=/images/www.noulakaz.net-weblog-images-20050814-dmix.jpg alt="Image de presentation" referrerpolicy=no-referrer loading=lazy class=article_content__img_src></figure><p></p><p>N’ayant VRAIMENT pas envie d&rsquo;utiliser quelque chose comme Jack, PulseAudio et autres machines a gaz nécessitant moults configurations, direction Dmix le plugin d&rsquo;Alsa. Alsa, mixage de sources = Dmix.</p><p>Dmix est un serveur de son, il vient s&rsquo;interposer entre le logiciel source du signal audio et le pilote (Alsa). Il a pour vocation de mélanger les sources audio afin d&rsquo;en envoyer une unique au pilote. Dmix est un plugins activé par défaut sur les installations actuel de Alsa, il est contenu dans le package &ldquo;alsa-utils&rdquo;.</p><p>Le problème étant que Dmix n&rsquo;est pas capable de mixer des sources destiné a plusieurs cartes son. Il faut donc indiquer a Alsa que chaque carte son est traité par Dmix indépendamment et ensuite envoyé au pilote qui les regroupes.</p><p>Les problèmes :</p><p>1- Pas de cartes son multiples avec Dmix</p><p>2- Dmix cause une perte de qualité sonore</p><p>3- Le traitement des cartes son séparément demande d&rsquo;effectuer deux fois le boulot</p><h4 id=1-pas-de-cartes-son-multiples>1) Pas de cartes son multiples</h4><p>Comme nous l&rsquo;avons vu Dmix est activé pas défaut, mais n&rsquo;est pas capable de mixer plusieurs cartes. Celui-ci est désactivé si plusieurs cartes sont configuré pour alsa.</p><p>Voici la solution, définir dmix pour chaque carte indépendamment, puis lier la sortie. Script :</p><pre tabindex=0><code># réglage des cartes son, selon la commande « aplay -l », card = carte et device = périphérique
pcm.carteInterne {
    type hw
    card 0
    device 0
}

ctl.carteInterne {
    type hw
    card 0
    device 0
}

pcm.carteUsb {
    type hw
    card 2
    device 0
}

ctl.carteUsb {
    type hw
    card 2
    device 0
}

# Creation d&#39;un Dmix pour chacune 
pcm.interneMix {
    type dmix
    ipc_key 1024
    ipc_key_add_uid false
    ipc_perm 0666
    slave {
        pcm &#34;carteInterne&#34;
        channels 2
        periods 128
        period_time 0
        period_size 2048
        buffer_size 4096
    }
    bindings {
        0 0
        1 1
    }
}

pcm.usbMix {
    type dmix
    ipc_key 2048
    ipc_key_add_uid false
    ipc_perm 0666
    slave {
        pcm &#34;carteUsb&#34;
        channels 2
        periods 128
        period_time 0
        period_size 2048
        buffer_size 4096
    }
    bindings {
        0 0
        1 1
    }
}

# Sortie multi cartes
pcm.both {
    type route;
    slave.pcm {
        type multi;
        slaves.a.pcm &#34;interneMix&#34;;
        slaves.b.pcm &#34;usbMix&#34;;
        slaves.a.channels 2;
        slaves.b.channels 2;

        bindings.0.slave a;
        bindings.0.channel 0;
        bindings.1.slave a;
        bindings.1.channel 1;
     
        bindings.2.slave b;
        bindings.2.channel 0;
        bindings.3.slave b;
        bindings.3.channel 1;
    }
    ttable.0.0 1;
    ttable.1.1 1;
  
    ttable.0.2 1;
    ttable.1.3 1;
}

pcm.!default {
        type plug
        slave {
                pcm both
        }
}

ctl.!default {
        type hw
        card 2
}
</code></pre><h4 id=2-perte-de-qualité-sonore>2) Perte de qualité sonore</h4><p>La seul solution a ma connaissance est d’éviter le ré-échantillonnage. A la base Alsa à une fréquence d&rsquo;échantillonnage de 48000hz, n’écoutant que des flac provenant de rip cd a une fréquence de 44100hz ce n&rsquo;est pas adapté.</p><p>Il faut donc passer en &ldquo;rate 44100&rdquo; (regardez le rate de vos medias).</p><p>Deux façons de faire, ajouter la ligne &ldquo;defaults.pcm.dmix.!rate 44100&rdquo; a votre fichier .asoundrc, soit ajouter &ldquo;rate 44100&rdquo; dans la section slave de votre carte avec dmix.</p><p>Même chose pour :</p><p>defaults.pcm.dmix.!rate_converter &ldquo;samplerate_best&rdquo;, qui interviens si malgré tout il y avait besoin d&rsquo;un re-échantillonnage</p><h4 id=3-effectuer-deux-fois-le-boulot>3) Effectuer deux fois le boulot</h4><p>Il est possibles que les veilles config ne supporte pas la solution <strong>1</strong>, il est donc possible de réaliser deux fichier asoundrc que l&rsquo;on &ldquo;switch&rdquo; suivant l&rsquo;utilisation de l&rsquo;une ou l&rsquo;autre carte son.</p><hr><p>En esperant n&rsquo;avoir rien oublié, plus d&rsquo;informations disponibles sur <a href=http://fr.wikipedia.org/wiki/Advanced_Linux_sound_architecture class="article_content__link link inherit" rel="noreferrer nofollow noopener">wikipedia</a>, <a href=http://doc.ubuntu-fr.org/son class="article_content__link link inherit" rel="noreferrer nofollow noopener">wikiUbuntu</a>, <a href=http://alsa.opensrc.org/Dmix class="article_content__link link inherit" rel="noreferrer nofollow noopener">DmixAlsa</a> et le script est aussi disponible sur le <a href=http://wiki.archlinux.fr/Alsa class="article_content__link link inherit" rel="noreferrer nofollow noopener">wikiArchLinux</a></p><p><strong>éa, les amis.</strong></p><aside class="article_comm right"><a class="article_comm__email btn inherit right monospace" href="mailto:adrien@iglou.eu?subject=%5BCommentaire%5D+%5bAlsa%2bDmix%5d%20Mixer%20les%20sources%20pour%20plusieurs%20cartes&body=Bonjour%20Adrien%2C%0D%0A">M'envoyer un commentaire</a>
·
<a class="article_comm__issue btn inherit right monospace" href="https://github.com/IGLOU-EU/blog.iglou.eu/issues/new?title=Erreur:+%5bAlsa%2bDmix%5d%20Mixer%20les%20sources%20pour%20plusieurs%20cartes&body=Lien:+https%3a%2f%2fblog.iglou.eu%2falsa-mixer-les-sources-avec-plusieurs%2f%0A%0AMince+quel+est+mon+erreur+?%0A">Reporter une erreur</a></aside></article></main><footer><hr class=hr><p class="footer monospace center">Site et contenue sous CC0 - Iconographie par Font Awesome - Sans Cookies ni tracking</p></footer></body></html>