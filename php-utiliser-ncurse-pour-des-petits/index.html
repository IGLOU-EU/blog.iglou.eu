<!doctype html><html lang=fr-fr dir=ltr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes,viewport-fit=cover"><title>[PHP] Utiliser ncurse pour des petits projets php | Blog Iglou.eu</title>
<link rel=icon href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48dGV4dCB5PSIuOWVtIiBmb250LXNpemU9IjkwIj7wn5K+PC90ZXh0Pjwvc3ZnPg=="><link rel=canonical href=https://blog.iglou.eu/php-utiliser-ncurse-pour-des-petits/><meta itemprop=name content="[PHP] Utiliser ncurse pour des petits projets php"><meta itemprop=description content="Cet article est issu d’une importation historique.
Il fut fait sans correcteur orthographique et grammaticale, il est aussi fort probable que des images et liens soient indisponible. ⚡️ Je détiens la Curse toute puissante ⚔️ Alors oui, la curse ce n’est pas vraiment aimé, puis on en croise de moins en moins. N’empêche que j’aime bien moi, c’est classe et faire du curse en PHP c’est rigolo.
Envie d’un Dwarf Fortress en PHP ?"><meta itemprop=datePublished content="2015-11-30T09:00:00+00:00"><meta itemprop=dateModified content="2015-11-30T09:00:11+00:00"><meta itemprop=wordCount content="840"><meta itemprop=keywords content="Programmation"><meta property="og:url" content="https://blog.iglou.eu/php-utiliser-ncurse-pour-des-petits/"><meta property="og:site_name" content="Blog Iglou.eu"><meta property="og:title" content="[PHP] Utiliser ncurse pour des petits projets php"><meta property="og:description" content="Cet article est issu d’une importation historique.
Il fut fait sans correcteur orthographique et grammaticale, il est aussi fort probable que des images et liens soient indisponible. ⚡️ Je détiens la Curse toute puissante ⚔️ Alors oui, la curse ce n’est pas vraiment aimé, puis on en croise de moins en moins. N’empêche que j’aime bien moi, c’est classe et faire du curse en PHP c’est rigolo.
Envie d’un Dwarf Fortress en PHP ?"><meta property="og:locale" content="fr_fr"><meta property="og:type" content="article"><meta property="article:published_time" content="2015-11-30T09:00:00+00:00"><meta property="article:modified_time" content="2015-11-30T09:00:11+00:00"><meta property="article:tag" content="Programmation"><link href=https://blog.iglou.eu/index.xml rel=alternate type=application/rss+xml title="Blog Iglou.eu"><link rel=stylesheet href=/css/style.min.04f4b7997c4f8621b627767bda0b5f35702bcb14fff156b6c784df451dba02e0.css integrity="sha256-BPS3mXxPhiG2J3Z72gtfNXAryxT/8Va2x4TfRR26AuA=" crossorigin=anonymous></head><body><div class=toggle-widget id=open-left_panel><style>#open-left_panel .toggle-close{display:none}#open-left_panel:target~.content-main .left_panel{display:block;position:fixed;top:0;left:0;right:0;bottom:0;overflow:auto;z-index:10}#open-left_panel:target .toggle-icon-line{background-color:var(--color-wtoggle-line-focus)}#open-left_panel:target .toggle-icon-line.vertical{transform:rotate(360deg)}#open-left_panel:target .toggle-icon-line.horizontal{transform:rotate(180deg)}#open-left_panel:target .toggle-close{display:initial}#open-left_panel:target .toggle-open{display:none}</style><div class=toggle-icon><span class="toggle-icon-line vertical"></span>
<span class="toggle-icon-line horizontal"></span></div><a class="toggle-open toggle-link" title="Ouvrir Left panel" href=#open-left_panel></a><a class="toggle-close toggle-link" title="Fermer Left panel" href=#close-left_panel></a></div><header class=site-header><h1>Blog Iglou.eu</h1><nav class=main-menu><ul><li><a href=/>Accueil</a></li></ul></nav></header><main class=content-main><div class=top_panel><aside class=article-info><span class=date-info>Le <time class=published datetime=2015-11-30T09:00:00Z>30 Nov 2015
</time>· Maj le <time class=editited datetime=2015-11-30T09:00:11Z>30 Nov 2015
</time></span><span class=spacer></span>
<span class=reading-time>3-6 minutes</span></aside></div><div class=left_panel><aside class=sidebar><div class=toc><h2 class=toc-title>Table des Matières</h2><nav id=TableOfContents><ul><li><ul><li><a href=#-je-détiens-la-curse-toute-puissante->⚡️ Je détiens la Curse toute puissante ⚔️</a></li><li><a href=#installation>Installation</a></li><li><a href=#les-bases>Les bases</a></li><li><a href=#à-vous-de-jouer>À vous de jouer</a></li></ul></li></ul></nav></div><div class=tags><h2 class=tags-title>Tags</h2><ul class=tags-list><li class=tags-item><a class=tags-link href=https://blog.iglou.eu/tags/programmation/>Programmation</a></li></ul></div></aside></div><div class=right_panel><article class="blog-article markdown"><div class="box warning monospace"><span>Cet article est issu d&rsquo;une importation historique.<br>Il fut fait sans correcteur orthographique et grammaticale, il est aussi fort probable que des images et liens soient indisponible.</span></div><h3 id=-je-détiens-la-curse-toute-puissante->⚡️ Je détiens la Curse toute puissante ⚔️</h3><p>Alors oui, la curse ce n&rsquo;est pas vraiment aimé, puis on en croise de moins en moins. N’empêche que j&rsquo;aime bien moi, c&rsquo;est classe et faire du curse en PHP c&rsquo;est rigolo.</p><p></p><figure class=article-img><a href=/images/_Screenshot_DwarfFortressThree.png target=_blank title="Ouvrir l'image dans un onglet"><img src=/images/_Screenshot_DwarfFortressThree.png alt="Image de presentation" referrerpolicy=no-referrer loading=lazy class=img-src></a><figcaption class=img-desc>Envie d&rsquo;un Dwarf Fortress en PHP ?</figcaption></figure><p></p><p>La lib Ncurse pour PHP est &ldquo;standard&rdquo; et le man Ncurse peut du coup être utilisé.</p><h4 id=pourquoi-faire-ce-petit-article->Pourquoi faire ce petit article ?</h4><p>Pour présenter la lib en PHP, faire une petite introduction du fonctionnement…</p><p>Finalement, cet article est peut-être plus pour moi qu&rsquo;autre chose.</p><h4 id=attention->ATTENTION !</h4><p>Les programmes écrits en C ont généralement deux fonctionnements True/False.
.1 Ceux qui utilisent -1 en cas d&rsquo;erreur et sinon 0 (plus répandus)
.2 Ceux qui font l&rsquo;inverse (plus classique)</p><p>Ncurse est le 1er cas, ne l&rsquo;oubliez pas dans vos structures de testes.</p><h3 id=installation>Installation</h3><ul><li>Installer Ncurse</li><li>Installe PECL</li><li>$ svn checkout
<a href=http://svn.php.net/repository/pecl/ncurses/ class=external-link rel="noreferrer nofollow noopener" target=_blank>http://svn.php.net/repository/pecl/ncurses/</a>
ncurses</li><li>$ cd ncurses/tags/ncurses-1.0.2/trunk/</li></ul><p>// J&rsquo;ai un problème avec cette extension et PECL du coup…</p><ul><li>$ pecl build</li></ul><p>// Sois je copie à la main (crade)</p><ul><li>$ sudo cp &lt;LienRetournéParPecl> /usr/lib/php/modules/</li></ul><p>// Sois-je compile, puis, installe</p><ul><li>$ ./configure && make</li><li>$ sudo make install #ou make install</li></ul><p><strong>Les pages à garder sous la main :</strong></p><ul><li><a href=http://php.net/manual/en/ncurses.colorconsts.php class=external-link rel="noreferrer nofollow noopener" target=_blank>Les couleurs prés définies</a></li><li><a href=http://php.net/manual/en/ncurses.keyconsts.php class=external-link rel="noreferrer nofollow noopener" target=_blank>Les Clés du clavier (les clés sont des int 8bit)</a></li><li><a href=http://php.net/manual/en/ncurses.mouseconsts.php class=external-link rel="noreferrer nofollow noopener" target=_blank>Les actions de souris</a></li><li><a href=http://php.net/manual/en/ref.ncurses.php class=external-link rel="noreferrer nofollow noopener" target=_blank>La liste des fonctions de Ncurse (à utiliser avec un ctrl+f)</a></li></ul><h3 id=les-bases>Les bases</h3><p><strong>Initialiser ncurse puis le détruire.</strong><br><em>Je vous donne le contenu de mes fonctions, la source à la fin.</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// Initialisation de la lib
</span></span></span><span style=display:flex><span><span style=color:#75715e>// [ncurses_init](http://php.net/manual/fr/function.ncurses-init.php)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>ncurses_init</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Désactivation de la souris
</span></span></span><span style=display:flex><span><span style=color:#75715e>// [ncurses_curs_set](http://php.net/manual/fr/function.ncurses-curs-set.php)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>ncurses_curs_set</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Vérifier si les couleurs sont supporté et les activer
</span></span></span><span style=display:flex><span><span style=color:#75715e>// [ncurses_start_color](http://php.net/manual/fr/function.ncurses-start-color.php)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> ( <span style=color:#a6e22e>ncurses_start_color</span>() <span style=color:#f92672>===</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>exit</span>(<span style=color:#e6db74>&#39;ERR : ncurses_newwin =&gt; Color not supported !&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// On enregistre la nouvelle window; // (0, 0, 0, 0) = Nombre de rangés, de colonnes, position x, y
</span></span></span><span style=display:flex><span><span style=color:#75715e>// [ncurses_newwin](http://php.net/manual/fr/function.ncurses-newwin.php)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>window</span> <span style=color:#f92672>=</span> (<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// On check si la fenêtre est bien initialisé
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>window</span> <span style=color:#f92672>!==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    [<span style=color:#a6e22e>ncurses_refresh</span>](<span style=color:#a6e22e>http</span><span style=color:#f92672>://</span><span style=color:#a6e22e>php</span><span style=color:#f92672>.</span><span style=color:#a6e22e>net</span><span style=color:#f92672>/</span><span style=color:#a6e22e>manual</span><span style=color:#f92672>/</span><span style=color:#a6e22e>fr</span><span style=color:#f92672>/</span><span style=color:#a6e22e>function</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ncurses</span><span style=color:#f92672>-</span><span style=color:#a6e22e>refresh</span><span style=color:#f92672>.</span><span style=color:#a6e22e>php</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ncurses_refresh</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Taille de la fenêtre,  STDSCR = default window, retourne height/width
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// [ncurses_getmaxyx](http://php.net/manual/fr/function.ncurses-getmaxyx.php)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>ncurses_getmaxyx</span>(<span style=color:#a6e22e>STDSCR</span>, $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>size</span>[<span style=color:#e6db74>&#39;height&#39;</span>], $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>size</span>[<span style=color:#e6db74>&#39;width&#39;</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    [<span style=color:#a6e22e>ncurses_noecho</span>](<span style=color:#a6e22e>http</span><span style=color:#f92672>://</span><span style=color:#a6e22e>php</span><span style=color:#f92672>.</span><span style=color:#a6e22e>net</span><span style=color:#f92672>/</span><span style=color:#a6e22e>manual</span><span style=color:#f92672>/</span><span style=color:#a6e22e>fr</span><span style=color:#f92672>/</span><span style=color:#a6e22e>function</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ncurses</span><span style=color:#f92672>-</span><span style=color:#a6e22e>noecho</span><span style=color:#f92672>.</span><span style=color:#a6e22e>php</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ncurses_noecho</span>(); <span style=color:#75715e>// Ne rien afficher d&#39;exterieur
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>exit</span>(<span style=color:#e6db74>&#39;ERR : ncurses_newwin =&gt; FAIL !&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Afin d&rsquo;utiliser exit() proprement, on utilise ici __destruct()</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> __destruct() {
</span></span><span style=display:flex><span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>envSound</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// [ncurses_end](http://php.net/manual/fr/function.ncurses-end.php)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>ncurses_end</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Pour check les inputKey</strong> c&rsquo;est simple, à savoir que les fonctions de ncurses sont bloquantes, donc pas vraiment intéressantes… L&rsquo;astuce est tout simplement d&rsquo;ouvrir stdin en lecture, le définir comme non bloquant, puis de le lire &mldr; Easy ! Il ne reste qu&rsquo;à faire un switch pour gérer l&rsquo;action de vos inputs.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getStdin</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// [fopen](http://php.net/manual/fr/function.fopen.php)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $stdin <span style=color:#f92672>=</span> <span style=color:#a6e22e>fopen</span>(<span style=color:#e6db74>&#39;php://stdin&#39;</span>, <span style=color:#e6db74>&#39;r&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// [stream_set_blocking](http://php.net/manual/fr/function.stream-set-blocking.php)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>stream_set_blocking</span>($stdin, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// [fread](http://php.net/manual/fr/function.fread.php)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>usedKey</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fread</span>($stdin, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>En gros voici la base, après, il y a deux trois fonctions utiles qu&rsquo;il peut être compliqué à comprendre ou trouver.</p><p><strong>Ma fonction de &ldquo;d&rsquo;affichage&rdquo;</strong> se compose de :</p><ul><li><a href=http://php.net/manual/fr/function.ncurses-wclear.php class=external-link rel="noreferrer nofollow noopener" target=_blank>ncurses_wclear</a>
// Vide la fenêtre</li><li><a href=http://php.net/manual/fr/function.ncurses-wrefresh.php class=external-link rel="noreferrer nofollow noopener" target=_blank>ncurses_wrefresh</a>
// Rafraichir la fenêtre</li><li><a href=http://php.net/manual/fr/function.ncurses-getmaxyx.php class=external-link rel="noreferrer nofollow noopener" target=_blank>ncurses_getmaxyx</a>
// Reprendre la taille de la fenêtre pour s&rsquo;adapter à un resize</li><li><a href=http://php.net/manual/fr/function.ncurses-border.php class=external-link rel="noreferrer nofollow noopener" target=_blank>ncurses_border</a>
// Retirer toutes bordures</li></ul><p>pour ce qui concerne le petit coup de nettoyage avant affichage,</p><ul><li><a href=http://php.net/manual/fr/function.ncurses-wattron.php class=external-link rel="noreferrer nofollow noopener" target=_blank>ncurses_wattron</a>
// Remplace les attributs de la fenêtre, taille de police, couleur de fond…</li><li><a href=http://php.net/manual/fr/function.ncurses-wattroff.php class=external-link rel="noreferrer nofollow noopener" target=_blank>ncurses_wattroff</a>
// Retour a la normale</li><li><a href=http://php.net/manual/fr/function.ncurses-wcolor-set.php class=external-link rel="noreferrer nofollow noopener" target=_blank>ncurses_wcolor_set</a>
// Changer les couleurs, dépends des couleurs déclarées avec
<a href=http://php.net/manual/fr/function.ncurses-init-pair.php class=external-link rel="noreferrer nofollow noopener" target=_blank>ncurses_init_pair</a></li></ul><p>voilà ce qui concerne la partie mise en forme, puis un petit coup de rafraichissement</p><ul><li><a href=http://php.net/manual/fr/function.ncurses-wmove.php class=external-link rel="noreferrer nofollow noopener" target=_blank>ncurses_wmove</a>
// Sortir le curseur du champ (dans ce cas précis)</li><li><a href=http://php.net/manual/fr/function.ncurses-wrefresh.php class=external-link rel="noreferrer nofollow noopener" target=_blank>ncurses_wrefresh</a>
// Rafraichir la fenêtre</li></ul><p><strong>Pour gérer l&rsquo;affichage de char</strong> on utilise juste</p><ul><li><a href=http://php.net/manual/fr/function.ncurses-wmove.php class=external-link rel="noreferrer nofollow noopener" target=_blank>ncurses_wmove</a>
// Bouger le curseur où l&rsquo;on veut afficher le char</li><li><a href=http://php.net/manual/fr/function.ncurses-waddstr.php class=external-link rel="noreferrer nofollow noopener" target=_blank>ncurses_waddstr</a>
// Ajouter un char a l&rsquo;emplacement du curseur</li></ul><p>Il suffit de faire une boucle pour afficher une string</p><hr><h3 id=à-vous-de-jouer>À vous de jouer</h3><p>Ba rien qu&rsquo;avec cette minibase-là, il est possible de faire tout ce que l&rsquo;on désire ou presque, que ce soit du jeu comme des logiciels. C&rsquo;est vraiment super simple et pour les personnes qui ne font que du PHP ça fait le boulot !</p><p>La lib n&rsquo;est pas vraiment lourde, elle ne bloque pas PHP (contrairement à php-gtk)
et est simple d&rsquo;utilisation. En même temps cette lib a toujours était génial, PHP ou pas.</p><p>Voici la source de mon petit snake, bien sûr il y a beaucoup d’améliorations possibles, je ne fais notamment que très rarement du PHP OO, là, ce fut un choix pour le porté des variables principalement et la volonté de faire ça &ldquo;propre&rdquo; mais en un seul fichier.</p><p>C&rsquo;est codé pas trop salement et en quelque heures sur deux jours
<a href=http://inuit.iglou.eu/iglou.adrien/Snake/blob/master/snake class=external-link rel="noreferrer nofollow noopener" target=_blank>http://inuit.iglou.eu/iglou.adrien/Snake/blob/master/snake</a></p><p>Prochaine fois <strong>petit</strong> tour sur PHP-GTK histoire de pas trop en chi*r si vous voulez débuter avec, je n&rsquo;ai pas fini mon projet avec et ne le finirais jamais…
C&rsquo;est insupportable (pour moi) de ne pas gérer mes boucles et interactions à la main.</p><p><strong>éa, les amis.</strong></p></article></div></main><footer class=site-footer><p>Copyright 2024 CC0 - Sans Cookies ni tracking</p></footer></body></html>